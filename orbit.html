<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Earth‚ÄìMoon System Visualization</title>
  <style>
    :root {
      --color-black: #000;
      --color-white: #FFF;
      --color-white-50-opacity: #FFF8;
      --color-primary: #FFFFFF1F;
      --color-primary-hover: #FFFFFF40;
      --color-border: #FFFFFF59;
      --color-border-light: #FFFFFF40;
      --color-background: #00000059;
      --color-light-blue: #4488FF;
      --color-light-gray: #FFFFFF4D;
      --color-green-yellow: #6B8E23;
      --color-rise: #C0C0C0; /* Silver for moonrise */
      --color-set: #808080;  /* Gray for moonset */
      --opacity-disabled: 0.35;
      --opacity-enabled: 1;
    }
    body {
      margin: 0;
      overflow: hidden;
      background: var(--color-black);
    }
    body.observer-mode {
      cursor: crosshair;
    }
    #hud {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      color: var(--color-white);
      font: 14px/1.2 system-ui, sans-serif;
      pointer-events: none; /* let clicks pass through by default */
    }
    .hud__row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 12px;
      margin: 0 auto 4px auto;
      width: 96%;
      max-width: 900px;
      background: var(--color-background);
      backdrop-filter: blur(8px);
      border: 1px solid var(--color-border-light);
      border-radius: 8px;
      pointer-events: auto;
    }
    .hud__group {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    /* This new rule is specific enough to override the display:flex rule */
    .hud__group[hidden] {
      display: none;
    }
    input, button {
      font: inherit;
      color: inherit;
      background: var(--color-primary);
      border: 1px solid var(--color-border);
      border-radius: 4px;
      padding: 4px 6px;
    }
    button {
      cursor: pointer;
      min-width: 32px;
    }
    button:hover {
      background: var(--color-primary-hover);
    }
    input[type=range] {
      width: 180px;
      accent-color: var(--color-primary);
      background: var(--color-primary);
    }
    /* camera row */
    .hud__cam {
      justify-content: space-between;
      gap: 6px;
    }
    .cam-btn {
      width: 32px;
      opacity: var(--opacity-disabled);
    }
    .cam-btn.saved {
      opacity: var(--opacity-enabled);
      background: var(--color-white-50-opacity);
    }
    .cam-btn.active {
      border: 2px solid var(--color-light-blue);
      box-shadow: 0 0 8px var(--color-white-50-opacity);
    }
    #open-input-panel.saved {
      opacity: var(--opacity-enabled);
      background: var(--color-white-50-opacity);
    }
    #observer-btn.enabled {
      opacity: var(--opacity-enabled);
      background: var(--color-white-50-opacity);
    }
    #lock-indicator {
      display: none;
      font-size: 16px;
      padding: 4px 6px;
      background: transparent;
      border: none;
    }
    #lock-indicator.active {
      display: block;
    }
    #loader-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--color-black); /* Dark background */
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999; /* Ensure it's on top of everything */
      transition: opacity 0.5s ease-out; /* Smooth fade-out */
    }
    #loader-overlay.hidden {
      opacity: 0;
      pointer-events: none; /* Allow clicks to pass through once hidden */
    }
    .loader-spinner {
      border: 4px solid var(--color-light-gray);
      border-top: 4px solid var(--color-white);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    #event-indicator {
      font-size: 18px;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }
    #event-indicator.sunrise {
      background-color: var(--color-rise);
      color: var(--color-black);
    }
    #event-indicator.sunset {
      background-color: var(--color-set);
      color: var(--color-white);
    }
    #event-indicator.moonrise {
      background-color: var(--color-rise);
      color: var(--color-black);
    }
    #event-indicator.moonset {
      background-color: var(--color-set);
      color: var(--color-white);
    }
    #event-indicator.suntransit {
      background-color: var(--color-rise);
      color: var(--color-black);
    }
    #event-indicator.moonnew {
      background-color: var(--color-set);
      color: var(--color-white);
    }
    .data-box {
      display: flex;
      flex-direction: column;
      gap: 4px;
      padding: 6px 8px;
      background: var(--color-background);
      border: 1px solid var(--color-border-light);
      border-radius: 6px;
      font-size: 13px;
    }
    .data-value {
      font-family: monospace;
      font-size: 14px;
      color: var(--color-white);
      opacity: 0.9;
    }
    .data-label {
      font-weight: normal;
      color: var(--color-white);
      opacity: 0.55;
      min-width: 30px;
      text-align: center;
    }
    #observer-data-group .data-box input {
      font-family: monospace;
      font-size: 14px;
      text-align: center;
      padding: 2px 4px;
    }
    .speed-value-box {
      display: flex;
      align-items: center;
      padding: 4px 8px;
      background: var(--color-background);
      border: 1px solid var(--color-border-light);
      border-radius: 4px;
      text-align: right;
      font-family: monospace;
      font-size: 14px;
      color: var(--color-white);
      opacity: 0.9;
    }
    #crosshair {
      display: none; /* Hidden by default */
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10; /* Ensures it's above the canvas but below the loader */
      color: var(--color-green-yellow);
      font-size: 26px;
      font-weight: normal;
      opacity: 0.6;
      pointer-events: none; /* CRITICAL: Allows mouse events to pass through to the canvas */
    }
    #crosshair.visible {
      display: block;
    }

    #input-panel {
      position: fixed;
      top: 20%;
      right: 20px;
      transform: none;
      z-index: 1000;
      pointer-events: none; /* default non-blocking */
    }

    #input-panel:not([hidden]) {
      pointer-events: auto; /* only when visible */
    }

    .panel-content {
      background: rgba(0, 0, 0, 0.25); /* semi-transparent dark */
      backdrop-filter: blur(6px);
      border: 1px solid var(--color-border-light);
      border-radius: 10px;
      padding: 16px;
      color: var(--color-white-50-opacity);
      font: 14px system-ui, sans-serif;
      width: 300px;
      max-width: 90vw;
    }

    .panel-content h3 {
      margin: 0 0 12px;
      font-size: 18px;
      text-align: center;
    }

    .panel-content label {
      display: flex;
      flex-direction: column;
      margin-bottom: 12px;
      gap: 4px;
    }

    .panel-content input,
    .panel-content select {
      font: inherit;
      padding: 6px 8px;
      background: var(--color-primary);
      border: 1px solid var(--color-border);
      border-radius: 4px;
      color: var(--color-white);
    }

    .panel-content select option {
      color: var(--color-black);
    }

    .panel-buttons {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      margin-top: 8px;
    }

    .panel-buttons button {
      flex: 1;
      padding: 6px;
      background: var(--color-primary);
      border: 1px solid var(--color-border);
      border-radius: 4px;
      color: var(--color-white);
      cursor: pointer;
    }

    .panel-buttons button:hover {
      background: var(--color-primary-hover);
    }
  </style>
</head>
<body>

<div id="loader-overlay">
  <div class="loader-spinner"></div>
</div>

<div id="crosshair">+</div>

<div id="input-panel" hidden>
  <div class="panel-content">
    <h3>Satellite</h3>
    <label>
      Group:
      <select id="panel-group">
        <option value="" disabled selected>Select a group...</option>
        <option value="Geo">Geo</option>
      </select>
    </label>
    <label>
      Name:
      <select id="panel-name">
        <option value="" disabled selected>Select a satellite...</option>
        <option value="Eutelsat 7A">Eutelsat 7A</option>
      </select>
    </label>
    <label>
      Norad:
      <input type="text" id="panel-norad" placeholder="e.g. 28187">
    </label>
  </div>
</div>

<div id="hud">
  <div class="hud__row hud__main">
    <!-- LEFT -->
    <div class="hud__group">
      <label title="Date / Time UTC">
        <input id="sim-date" type="date">
        <input id="sim-time" type="time" step="60">
      </label>
    </div>

    <!-- CENTRE LEFT -->
    <div class="hud__group">
      <button id="btn-reverse" title="Reverse time">‚ñª</button>
      <button id="btn-play" title="Play/Pause">‚è∏</button>
      <button id="btn-reset" title="Reset">‚ü≤</button>
    </div>

    <!-- CENTRE (Event controls) -->
    <div class="hud__group" id="event-group" hidden>
        <button id="prev-event" title="Previous Event">&lt;</button>
        <div id="event-indicator"
             title="Celestial Events"
             class="sunrise"
             data-sunrise="‚òâ"
             data-sunset="‚òâ"
             data-moonrise="‚òΩ"
             data-moonset="‚òΩ"
             data-suntransit="‚òº"
             data-moonnew="üåë">‚òâ</div>
        <button id="next-event" title="Next Event">&gt;</button>
    </div>

    <!-- CENTRE RIGHT -->
    <div class="hud__group">
      <input id="speed-slider" type="range" min="0" max="120" step="0.2" value="1">
      <output id="speed-out" for="speed-slider" class="speed-value-box">- √ó</output>
      <button id="btn-speed-1x" title="Set to real-time speed">1√ó</button>
    </div>
  </div>

  <!-- Second row: camera snapshots -->
  <div class="hud__row hud__cam">
    <!-- Group 1: Left-aligned buttons -->
    <div class="hud__group">
      <button class="cam-btn" data-slot="1" title="Camera preset">1</button>
      <button class="cam-btn" data-slot="2" title="Camera preset">2</button>
      <button class="cam-btn" data-slot="3" title="Camera preset">3</button>
      <button id="observer-btn" title="Place Observer">üìç</button>
      <button id="observer-cam" class="cam-btn" data-slot="4" hidden>4</button>
      <button id="satellite-btn" class="cam-btn saved" data-slot="5" title="Satellite view" hidden>üõ∞Ô∏è</button>
    </div>

    <div id="observer-data-group" class="hud__group" hidden>
      <div class="data-box">
        <span class="data-label">Azimuth</span>
        <span class="data-value"><output id="azimuth-out">‚Äî</output></span>
      </div>
      <div class="data-box">
        <span class="data-label">Elevation</span>
        <span class="data-value"><output id="elevation-out">‚Äî</output></span>
      </div>
      <div class="data-box">
        <span class="data-label">Latitude</span>
        <input type="text" id="latitude-out" class="data-value" placeholder="‚Äî">
      </div>
      <div class="data-box">
        <span class="data-label">Longitude</span>
        <input type="text" id="longitude-out" class="data-value" placeholder="‚Äî">
      </div>
    </div>


    <!-- Group 2: Centered Satellite Data (Initially Hidden) -->
    <div id="sat-data-group" class="hud__group" hidden>
      <div class="data-box">
        <span class="data-label">Height</span>
        <span class="data-value"><output id="sat-height-out">‚Äî</output></span>
      </div>
      <div class="data-box">
        <span class="data-label">Ground</span>
        <span class="data-value"><output id="sat-grn-speed-out">‚Äî</output></span>
      </div>
      <div class="data-box">
        <span class="data-label">Inertial</span>
        <span class="data-value"><output id="sat-orbit-speed-out">‚Äî</output></span>
      </div>
    </div>

    <!-- Group 3: Right-aligned lock indicator -->
    <div class="hud__group">
        <div id="lock-indicator" title="Camera view locked">üîí</div>
        <button id="open-input-panel" title="Open input panel" hidden>‚öôÔ∏è</button>
    </div>
  </div>
</div>

<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
    "orbitControls": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/controls/OrbitControls.js"
  }
}
</script>
<script type="module" src="main.js"></script>
</body>
</html>
